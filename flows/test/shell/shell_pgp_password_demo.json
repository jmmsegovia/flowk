{
  "id": "pgp_password_demo",
  "description": "Demonstration of symmetric PGP encryption/decryption using the PGP action.",
  "tasks": [
    {
      "id": "pgp.vars",
      "description": "Declare PGP demo variables",
      "action": "VARIABLES",
      "scope": "flow",
      "overwrite": true,
      "vars": [
        {
          "name": "pgp_password",
          "type": "string",
          "value": "VerySecurePassword!"
        },
        {
          "name": "doc_one",
          "type": "string",
          "value": "Document number one"
        },
        {
          "name": "doc_two",
          "type": "string",
          "value": "Secret content two"
        }
      ]
    },
    {
      "id": "pgp.encrypt",
      "description": "Encrypt the demo documents using the PGP action",
      "action": "PGP",
      "steps": [
        {
          "id": "encrypt_doc_one",
          "operation": "ENCRYPT",
          "password": "${pgp_password}",
          "message": "${doc_one}",
          "armor": true,
          "fileName": "document1.txt"
        },
        {
          "id": "encrypt_doc_two",
          "operation": "ENCRYPT",
          "password": "${pgp_password}",
          "message": "${doc_two}",
          "armor": true,
          "fileName": "document2.txt"
        }
      ]
    },
    {
      "id": "pgp.capture_ciphertext",
      "description": "Capture encrypted payloads for the decrypt step",
      "action": "VARIABLES",
      "scope": "flow",
      "vars": [
        {
          "name": "doc_one_ciphertext",
          "type": "string",
          "value": "${from.task:pgp.encrypt.result$.steps[0].result.ciphertext.value}"
        },
        {
          "name": "doc_two_ciphertext",
          "type": "string",
          "value": "${from.task:pgp.encrypt.result$.steps[1].result.ciphertext.value}"
        }
      ]
    },
    {
      "id": "pgp.decrypt",
      "description": "Decrypt the encrypted payloads using the PGP action",
      "action": "PGP",
      "steps": [
        {
          "id": "decrypt_doc_one",
          "operation": "DECRYPT",
          "message": "${doc_one_ciphertext}",
          "passwords": [
            "${pgp_password}"
          ],
          "outputEncoding": "utf8"
        },
        {
          "id": "decrypt_doc_two",
          "operation": "DECRYPT",
          "message": "${doc_two_ciphertext}",
          "passwords": [
            "${pgp_password}"
          ],
          "outputEncoding": "utf8"
        }
      ]
    },
    {
      "id": "pgp.verify_content",
      "description": "Verify that the decrypted messages match the originals",
      "action": "EVALUATE",
      "if_conditions": [
        {
          "left": "${from.task:pgp.decrypt.result$.steps[0].result.plaintext.value}",
          "operation": "=",
          "right": "${doc_one}"
        },
        {
          "left": "${from.task:pgp.decrypt.result$.steps[1].result.plaintext.value}",
          "operation": "=",
          "right": "${doc_two}"
        }
      ],
      "then": {
        "continue": "PGP decrypt output matches the original messages"
      },
      "else": {
        "exit": "PGP decrypt output does not match the original messages"
      }
    },
    {
      "id": "print.pgp_summary",
      "description": "Print the PGP demo status and output locations",
      "action": "PRINT",
      "entries": [
        {
          "message": "PGP demo status",
          "value": "verified"
        }
      ]
    }
  ]
}
