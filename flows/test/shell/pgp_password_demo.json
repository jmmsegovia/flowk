{
  "id": "pgp_password_demo",
  "description": "Demonstration of the PGP action with key generation and symmetric encryption.",
  "tasks": [
        {
      "id": "vars",
      "description": "Declare variables",
      "action": "VARIABLES",
      "scope": "flow",
      "overwrite": true,
      "vars": [
        {
          "name": "OutputDirectory",
          "type": "string",
          "value": "./tmp/pgp-demo"
        }
      ]
    },
    {
      "id": "clean_output_dir",
      "description": "Clean up any existing output directory",
      "action": "SHELL",
      "shell": { "program": "bash", "args": ["-lc"] },
      "command": [
        "rm -rf ${OutputDirectory}"
      ]
    },
    {
      "id": "create_files",
      "description": "Generate the sample files that will be encrypted",
      "action": "SHELL",
      "shell": { "program": "bash", "args": ["-lc"] },
      "command": [
        "set -eu",
        "mkdir -p ${OutputDirectory}",
        "printf '%s\\n' 'Document number one' > ${OutputDirectory}/document1.txt",
        "printf '%s\\n' 'Secret content two' > ${OutputDirectory}/document2.txt"
      ]
    },
    {
      "id": "pgp_symmetric",
      "description": "Create keys, encrypt, and decrypt the files protected with a password",
      "action": "PGP",
      "steps": [
        {
          "id": "generate",
          "operation": "GENERATE_KEY",
          "alias": "demo",
          "name": "Demo User",
          "email": "demo@example.com",
          "rsaBits": 3072,
          "privateKeyPath": "${OutputDirectory}/demo_private.asc",
          "publicKeyPath": "${OutputDirectory}/demo_public.asc"
        },
        {
          "id": "encrypt1",
          "operation": "ENCRYPT",
          "password": "VerySecurePassword!",
          "messagePath": "${OutputDirectory}/document1.txt",
          "outputPath": "${OutputDirectory}/document1.txt.pgp",
          "armor": true,
          "fileName": "document1.txt"
        },
        {
          "id": "encrypt2",
          "operation": "ENCRYPT",
          "password": "VerySecurePassword!",
          "messagePath": "${OutputDirectory}/document2.txt",
          "outputPath": "${OutputDirectory}/document2.txt.pgp",
          "armor": true,
          "fileName": "document2.txt"
        },
        {
          "id": "decrypt1",
          "operation": "DECRYPT",
          "messagePath": "${OutputDirectory}/document1.txt.pgp",
          "passwords": [
            "VerySecurePassword!"
          ],
          "outputPath": "${OutputDirectory}/document1.decrypted.txt",
          "outputEncoding": "utf8"
        },
        {
          "id": "decrypt2",
          "operation": "DECRYPT",
          "messagePath": "${OutputDirectory}/document2.txt.pgp",
          "passwords": [
            "VerySecurePassword!"
          ],
          "outputPath": "${OutputDirectory}/document2.decrypted.txt",
          "outputEncoding": "utf8"
        }
      ]
    },
    {
      "id": "verify_content",
      "description": "Verify that the decrypted files match the originals",
      "action": "SHELL",
      "shell": { "program": "bash", "args": ["-lc"] },
      "command": [
        "set -eu",
        "cmp ${OutputDirectory}/document1.txt ${OutputDirectory}/document1.decrypted.txt",
        "cmp ${OutputDirectory}/document2.txt ${OutputDirectory}/document2.decrypted.txt"
      ]
    }
  ]
}
